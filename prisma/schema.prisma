generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId        String         @id @default(cuid())
  email         String         @unique
  passwordHash  String
  role          UserRole
  status        UserStatus     @default(ACTIVE)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  admin         Admin?
  company       Company?
  companyUsers  CompanyUser[]
  notifications Notification[]
  student       Student?
  systemLogs    SystemLog[]
  sessions      UserSession[]

  @@map("users")
}

model Student {
  studentId          String               @id @default(cuid())
  userId             String               @unique
  firstName          String
  lastName           String
  phone              String?
  location           String?
  linkedinUrl        String?
  websiteUrl         String?
  elevatorPitch      String?
  profilePicture     String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  applications       Application[]
  experiences        Experience[]
  matchScores        MatchScore[]
  projects           Project[]
  recomputationQueue RecomputationQueue[]
  courses            StudentCourse[]
  documents          StudentDocument[]
  metrics            StudentMetrics?
  preferences        StudentPreference[]
  profile            StudentProfile?
  skills             StudentSkill[]
  user               User                 @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("students")
}

model Company {
  companyId     String          @id @default(cuid())
  userId        String          @unique
  companyName   String
  industry      String?
  location      String?
  website       String?
  logoPath      String?
  description   String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  user          User            @relation(fields: [userId], references: [userId], onDelete: Cascade)
  profile       CompanyProfile?
  companyUsers  CompanyUser[]
  opportunities Opportunity[]

  @@map("companies")
}

model Admin {
  adminId    String   @id @default(cuid())
  userId     String   @unique
  superAdmin Boolean  @default(false)
  inviteCode String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("admins")
}

model UserSession {
  sessionId    String   @id @default(cuid())
  userId       String
  jwtToken     String   @unique
  refreshToken String   @unique
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("user_sessions")
}

model University {
  universityId    String           @id @default(cuid())
  name            String           @unique
  location        String?
  website         String?
  createdAt       DateTime         @default(now())
  studentProfiles StudentProfile[]

  @@map("universities")
}

model Degree {
  degreeId        String           @id @default(cuid())
  name            String           @unique
  level           String
  createdAt       DateTime         @default(now())
  studentProfiles StudentProfile[]

  @@map("degrees")
}

model Major {
  majorId         String           @id @default(cuid())
  name            String           @unique
  field           String
  createdAt       DateTime         @default(now())
  studentProfiles StudentProfile[]

  @@map("majors")
}

model Course {
  courseId       String          @id @default(cuid())
  courseCode     String          @unique
  courseName     String
  credits        Int?
  description    String?
  createdAt      DateTime        @default(now())
  studentCourses StudentCourse[]

  @@map("courses")
}

model Skill {
  skillId                String                 @id @default(cuid())
  name                   String                 @unique
  category               String
  description            String?
  createdAt              DateTime               @default(now())
  experienceTechnologies ExperienceTechnology[]
  opportunitySkills      OpportunitySkill[]
  projectTechnologies    ProjectTechnology[]
  studentSkills          StudentSkill[]

  @@map("skills")
}

model Preference {
  preferenceId       String              @id @default(cuid())
  type               PreferenceType
  value              String
  description        String?
  createdAt          DateTime            @default(now())
  studentPreferences StudentPreference[]

  @@map("preferences")
}

model StudentProfile {
  studentProfileId      String      @id @default(cuid())
  studentId             String      @unique
  universityId          String?
  degreeId              String?
  majorId               String?
  gpa                   Float?
  graduationDate        DateTime?
  availabilityStartDate DateTime?
  attachmentDuration    Int?
  willingToRelocate     Boolean     @default(false)
  remoteAllowed         Boolean     @default(true)
  cvFilePath            String?
  transcriptFilePath    String?
  cvParsedText          String?
  transcriptParsedText  String?
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt
  degree                Degree?     @relation(fields: [degreeId], references: [degreeId])
  major                 Major?      @relation(fields: [majorId], references: [majorId])
  student               Student     @relation(fields: [studentId], references: [studentId], onDelete: Cascade)
  university            University? @relation(fields: [universityId], references: [universityId])

  @@map("student_profiles")
}

model StudentSkill {
  studentId         String
  skillId           String
  proficiency       Int      @default(1)
  yearsOfExperience Float?
  verified          Boolean  @default(false)
  createdAt         DateTime @default(now())
  skill             Skill    @relation(fields: [skillId], references: [skillId], onDelete: Cascade)
  student           Student  @relation(fields: [studentId], references: [studentId], onDelete: Cascade)

  @@id([studentId, skillId])
  @@map("student_skills")
}

model StudentCourse {
  studentId String
  courseId  String
  grade     String?
  semester  String?
  year      Int?
  createdAt DateTime @default(now())
  course    Course   @relation(fields: [courseId], references: [courseId], onDelete: Cascade)
  student   Student  @relation(fields: [studentId], references: [studentId], onDelete: Cascade)

  @@id([studentId, courseId])
  @@map("student_courses")
}

model StudentPreference {
  studentId    String
  preferenceId String
  priority     Int        @default(1)
  createdAt    DateTime   @default(now())
  preference   Preference @relation(fields: [preferenceId], references: [preferenceId], onDelete: Cascade)
  student      Student    @relation(fields: [studentId], references: [studentId], onDelete: Cascade)

  @@id([studentId, preferenceId])
  @@map("student_preferences")
}

model Experience {
  experienceId           String                 @id @default(cuid())
  studentId              String
  jobTitle               String
  company                String
  startDate              DateTime
  endDate                DateTime?
  role                   String?
  employmentType         EmploymentType
  description            String?
  createdAt              DateTime               @default(now())
  updatedAt              DateTime               @updatedAt
  experienceTechnologies ExperienceTechnology[]
  student                Student                @relation(fields: [studentId], references: [studentId], onDelete: Cascade)

  @@map("experiences")
}

model ExperienceTechnology {
  experienceId String
  skillId      String
  createdAt    DateTime   @default(now())
  experience   Experience @relation(fields: [experienceId], references: [experienceId], onDelete: Cascade)
  skill        Skill      @relation(fields: [skillId], references: [skillId], onDelete: Cascade)

  @@id([experienceId, skillId])
  @@map("experience_technologies")
}

model Project {
  projectId           String              @id @default(cuid())
  studentId           String
  projectName         String
  description         String?
  projectType         String?
  startDate           DateTime?
  endDate             DateTime?
  githubUrl           String?
  liveUrl             String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  projectTechnologies ProjectTechnology[]
  student             Student             @relation(fields: [studentId], references: [studentId], onDelete: Cascade)

  @@map("projects")
}

model ProjectTechnology {
  projectId String
  skillId   String
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [projectId], onDelete: Cascade)
  skill     Skill    @relation(fields: [skillId], references: [skillId], onDelete: Cascade)

  @@id([projectId, skillId])
  @@map("project_technologies")
}

model CompanyProfile {
  companyProfileId String   @id @default(cuid())
  companyId        String   @unique
  phone            String?
  employeeCount    String?
  foundedYear      Int?
  headquarters     String?
  companyType      String?
  benefits         String[]
  culture          String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  company          Company  @relation(fields: [companyId], references: [companyId], onDelete: Cascade)

  @@map("company_profiles")
}

model CompanyUser {
  companyUserId String          @id @default(cuid())
  companyId     String
  userId        String
  role          CompanyUserRole @default(RECRUITER)
  status        UserStatus      @default(ACTIVE)
  invitedBy     String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  company       Company         @relation(fields: [companyId], references: [companyId], onDelete: Cascade)
  user          User            @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([companyId, userId])
  @@map("company_users")
}

model Opportunity {
  opportunityId       String               @id @default(cuid())
  companyId           String
  title               String
  description         String
  location            String?
  industry            String?
  jobTypes            EmploymentType[]
  gpaThreshold        Float?
  isTechnical         Boolean              @default(true)
  startDate           DateTime?
  endDate             DateTime?
  applicationDeadline DateTime?
  status              OpportunityStatus    @default(DRAFT)
  salaryMin           Int?
  salaryMax           Int?
  currency            String?              @default("USD")
  benefits            String[]
  requirements        String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  applications        Application[]
  matchScores         MatchScore[]
  company             Company              @relation(fields: [companyId], references: [companyId], onDelete: Cascade)
  opportunitySkills   OpportunitySkill[]
  recomputationQueue  RecomputationQueue[]

  @@map("opportunities")
}

model OpportunitySkill {
  opportunityId String
  skillId       String
  skillWeight   Int         @default(1)
  required      Boolean     @default(false)
  createdAt     DateTime    @default(now())
  opportunity   Opportunity @relation(fields: [opportunityId], references: [opportunityId], onDelete: Cascade)
  skill         Skill       @relation(fields: [skillId], references: [skillId], onDelete: Cascade)

  @@id([opportunityId, skillId])
  @@map("opportunity_skills")
}

model Application {
  applicationId String            @id @default(cuid())
  studentId     String
  opportunityId String
  status        ApplicationStatus @default(SUBMITTED)
  coverLetter   String?
  appliedAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  reviewedBy    String?
  reviewNotes   String?
  matchScore    Float?
  opportunity   Opportunity       @relation(fields: [opportunityId], references: [opportunityId], onDelete: Cascade)
  student       Student           @relation(fields: [studentId], references: [studentId], onDelete: Cascade)
  interviews    Interview[]
  placement     Placement?

  @@unique([studentId, opportunityId])
  @@map("applications")
}

model Interview {
  interviewId      String          @id @default(cuid())
  applicationId    String
  interviewType    InterviewType
  scheduledDate    DateTime
  scheduledTime    String?
  duration         Int?
  interviewer      String?
  interviewerEmail String?
  meetingLink      String?
  location         String?
  status           InterviewStatus @default(SCHEDULED)
  feedback         String?
  rating           Int?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  application      Application     @relation(fields: [applicationId], references: [applicationId], onDelete: Cascade)

  @@map("interviews")
}

model Placement {
  placementId   String          @id @default(cuid())
  applicationId String          @unique
  startDate     DateTime
  endDate       DateTime?
  status        PlacementStatus @default(ACTIVE)
  salary        Int?
  currency      String?         @default("USD")
  feedback      String?
  rating        Int?
  companyRating Int?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  application   Application     @relation(fields: [applicationId], references: [applicationId], onDelete: Cascade)

  @@map("placements")
}

model Notification {
  notificationId String           @id @default(cuid())
  userId         String
  type           NotificationType
  title          String
  message        String
  read           Boolean          @default(false)
  actionUrl      String?
  metadata       Json?
  createdAt      DateTime         @default(now())
  readAt         DateTime?
  user           User             @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("notifications")
}

model SystemLog {
  logId     String   @id @default(cuid())
  userId    String?
  level     LogLevel @default(INFO)
  action    String
  details   String?
  metadata  Json?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [userId])

  @@map("system_logs")
}

model Queue {
  queueId     String      @id @default(cuid())
  taskType    String
  status      QueueStatus @default(PENDING)
  payload     Json
  priority    Int         @default(0)
  attempts    Int         @default(0)
  maxAttempts Int         @default(3)
  error       String?
  createdAt   DateTime    @default(now())
  processedAt DateTime?
  completedAt DateTime?

  @@map("queues")
}

model StudentMetrics {
  studentMetricsId String   @id @default(cuid())
  studentId        String   @unique
  skillScore       Float    @default(0)
  academicScore    Float    @default(0)
  experienceScore  Float    @default(0)
  preferenceScore  Float    @default(0)
  hireabilityScore Float    @default(0)
  lastComputed     DateTime @default(now())
  computeVersion   String   @default("1.0")
  metadata         Json?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  student          Student  @relation(fields: [studentId], references: [studentId], onDelete: Cascade)

  @@map("student_metrics")
}

model StudentDocument {
  documentId   String       @id @default(cuid())
  studentId    String
  documentType DocumentType
  fileName     String
  filePath     String
  fileSize     Int
  mimeType     String
  parsedText   String?
  parseStatus  ParseStatus  @default(PENDING)
  parseError   String?
  uploadedAt   DateTime     @default(now())
  parsedAt     DateTime?
  student      Student      @relation(fields: [studentId], references: [studentId], onDelete: Cascade)

  @@map("student_documents")
}

model MatchScore {
  matchScoreId    String      @id @default(cuid())
  studentId       String
  opportunityId   String
  totalScore      Float       @default(0)
  skillScore      Float       @default(0)
  academicScore   Float       @default(0)
  experienceScore Float       @default(0)
  preferenceScore Float       @default(0)
  status          MatchStatus @default(PENDING)
  computeVersion  String      @default("1.0")
  metadata        Json?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  opportunity     Opportunity @relation(fields: [opportunityId], references: [opportunityId], onDelete: Cascade)
  student         Student     @relation(fields: [studentId], references: [studentId], onDelete: Cascade)

  @@unique([studentId, opportunityId])
  @@map("match_scores")
}

model RecomputationQueue {
  queueId       String              @id @default(cuid())
  studentId     String?
  opportunityId String?
  status        RecomputationStatus @default(PENDING)
  priority      Int                 @default(0)
  triggerReason String?
  attempts      Int                 @default(0)
  maxAttempts   Int                 @default(3)
  error         String?
  createdAt     DateTime            @default(now())
  processedAt   DateTime?
  completedAt   DateTime?
  opportunity   Opportunity?        @relation(fields: [opportunityId], references: [opportunityId], onDelete: Cascade)
  student       Student?            @relation(fields: [studentId], references: [studentId], onDelete: Cascade)

  @@map("recomputation_queue")
}

model AILog {
  logId       String    @id @default(cuid())
  runType     AIRunType
  inputCount  Int       @default(0)
  outputCount Int       @default(0)
  runtimeMs   Int       @default(0)
  success     Boolean   @default(true)
  error       String?
  metadata    Json?
  triggeredBy String?
  createdAt   DateTime  @default(now())

  @@map("ai_logs")
}

model MatchingConfig {
  configId    String   @id @default(cuid())
  configKey   String   @unique
  configValue Json
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("matching_config")
}

enum UserRole {
  STUDENT
  COMPANY
  ADMIN
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  PENDING
  INACTIVE
}

enum CompanyUserRole {
  ADMIN
  MANAGER
  RECRUITER
}

enum ApplicationStatus {
  SUBMITTED
  IN_REVIEW
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum InterviewType {
  ONLINE
  ONSITE
  PHONE
  VIDEO
}

enum InterviewStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum PlacementStatus {
  ACTIVE
  COMPLETED
  CANCELLED
  TERMINATED
}

enum OpportunityStatus {
  ACTIVE
  CLOSED
  PENDING_APPROVAL
  REJECTED
  DRAFT
}

enum EmploymentType {
  INTERNSHIP
  PART_TIME
  FULL_TIME
  CONTRACT
  FREELANCE
}

enum PreferenceType {
  INDUSTRY
  LOCATION
  JOB_TYPE
  COMPANY_SIZE
  WORK_ENVIRONMENT
}

enum NotificationType {
  APPLICATION_UPDATE
  INTERVIEW_SCHEDULED
  OPPORTUNITY_MATCH
  SYSTEM_ALERT
  PLACEMENT_UPDATE
}

enum QueueStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  RETRYING
}

enum LogLevel {
  INFO
  WARNING
  ERROR
  DEBUG
}

enum MatchStatus {
  PENDING
  COMPUTED
  SHORTLISTED
  REJECTED
}

enum RecomputationStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum AIRunType {
  STUDENT_UPDATE
  OPPORTUNITY_UPDATE
  MANUAL_TRIGGER
  SCHEDULED_BATCH
}

enum DocumentType {
  CV
  TRANSCRIPT
  COVER_LETTER
  PORTFOLIO
  CERTIFICATE
}

enum ParseStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}
